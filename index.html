<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sleeper League Dashboard</title>
  <style>
    body {
      font-family: "Inter", sans-serif;
      background-color: #1e1e1e;
      color: #e1e1e1;
      margin: 0;
      padding: 0;
    }
    header {
      background: #111;
      padding: 1rem;
      text-align: center;
      border-bottom: 1px solid #333;
    }
    header h1 {
      margin: 0;
      color: #fff;
    }
    .container {
      padding: 1rem;
      max-width: 1200px;
      margin: auto;
    }
    .section {
      margin-bottom: 2rem;
    }
    .section h2 {
      color: #fff;
      border-left: 4px solid #ffd369;
      padding-left: 0.5rem;
    }
    .description {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 0.5rem;
    }
    .card {
      background: #2b2b2b;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .team-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .team-info img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }
    .badge {
      padding: 0.3rem 0.6rem;
      border-radius: 8px;
      font-weight: bold;
    }
    .badge.green { background: #2ecc71; color: #fff; }
    .badge.red { background: #e74c3c; color: #fff; }
    .badge.gray { background: #7f8c8d; color: #fff; }
    .matchup {
      display: flex;
      justify-content: space-between;
      background: #2b2b2b;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 0.5rem;
    }
    .team {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .team span {
      font-weight: bold;
    }
    .score {
      font-size: 1.2rem;
      font-weight: bold;
      min-width: 40px;
      text-align: right;
    }
    select {
      background: #111;
      color: #fff;
      padding: 0.4rem;
      border-radius: 6px;
      border: 1px solid #444;
      margin-bottom: 1rem;
    }
    @media(max-width: 600px) {
      .card, .matchup { flex-direction: column; text-align: center; }
      .team-info { justify-content: center; }
      .score { text-align: center; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Fantasy League Dashboard</h1>
  </header>
  <div class="container">

    <div class="section" id="power-rankings">
      <h2>Power Rankings</h2>
      <p class="description">Overall team strength based on record and points scored.</p>
      <div id="power-rankings-list"></div>
    </div>

    <div class="section" id="efficiency">
      <h2>Efficiency Rankings</h2>
      <p class="description">How well each team sets their lineup compared to optimal points.</p>
      <div id="efficiency-list"></div>
    </div>

    <div class="section" id="luck-index">
      <h2>Luck Index</h2>
      <p class="description">Measure of whether teams are winning/losing close games.</p>
      <div id="luck-list"></div>
    </div>

    <div class="section" id="playoff-odds">
      <h2>Playoff Odds</h2>
      <p class="description">Projected playoff chances using Monte Carlo simulations with real schedule.</p>
      <div id="odds-list"></div>
    </div>

    <div class="section" id="matchups">
      <h2>Matchups</h2>
      <label for="weekSelect">Week:</label>
      <select id="weekSelect"></select>
      <div id="matchup-list"></div>
    </div>

  </div>

  <script>
    const LEAGUE_ID = "1257464138565689344"; // replace with your ID
    let currentWeek = 1, seasonLength = 14, playoffSpots = 4;
    let teams = [];

    async function fetchLeagueData() {
      let leagueRes = await fetch(`https://api.sleeper.app/v1/league/${LEAGUE_ID}`);
      let league = await leagueRes.json();
      seasonLength = league.settings.playoff_week_start - 1;
      playoffSpots = league.settings.playoff_teams;

      let usersRes = await fetch(`https://api.sleeper.app/v1/league/${LEAGUE_ID}/users`);
      let users = await usersRes.json();

      let rostersRes = await fetch(`https://api.sleeper.app/v1/league/${LEAGUE_ID}/rosters`);
      let rosters = await rostersRes.json();

      teams = rosters.map(r => {
        let u = users.find(x => x.user_id === r.owner_id);
        return {
          roster_id: r.roster_id,
          wins: r.settings.wins,
          losses: r.settings.losses,
          fpts: r.settings.fpts,
          ppts: r.settings.ppts,
          name: r.metadata.team_name || u.display_name,
          avatar: u.avatar ? `https://sleepercdn.com/avatars/${u.avatar}` : "https://via.placeholder.com/40",
          manager: u.display_name
        };
      });
    }

    async function fetchCurrentWeek() {
      let stateRes = await fetch("https://api.sleeper.app/v1/state/nfl");
      let state = await stateRes.json();
      currentWeek = state.week;
    }

    function renderRankings() {
      let power = [...teams].sort((a,b)=>b.fpts - a.fpts);
      document.getElementById("power-rankings-list").innerHTML =
        power.map((t,i)=>cardHTML(t, i+1, "green")).join("");

      let eff = [...teams].sort((a,b)=>b.ppts - a.ppts);
      document.getElementById("efficiency-list").innerHTML =
        eff.map((t,i)=>cardHTML(t, i+1, "gray")).join("");

      let luck = [...teams].sort((a,b)=>(b.fpts-b.ppts) - (a.fpts-a.ppts));
      document.getElementById("luck-list").innerHTML =
        luck.map((t,i)=>cardHTML(t, i+1, "red")).join("");
    }

    function cardHTML(t, rank, color) {
      return `<div class="card">
        <div class="team-info">
          <img src="${t.avatar}">
          <div>
            <div>${t.name} - <small>${t.manager}</small></div>
          </div>
        </div>
        <span class="badge ${color}">#${rank}</span>
      </div>`;
    }

    async function calculatePlayoffOdds() {
      let results = teams.map(t => ({ ...t, playoffCount: 0 }));
      let sims = 2000; // lighter for mobile

      // Preload schedule
      let schedule = {};
      for (let w = currentWeek+1; w <= seasonLength; w++) {
        let res = await fetch(`https://api.sleeper.app/v1/league/${LEAGUE_ID}/matchups/${w}`);
        schedule[w] = await res.json();
      }

      for (let s = 0; s < sims; s++) {
        let simTeams = results.map(t => ({ ...t, wins: t.wins }));

        for (let w = currentWeek+1; w <= seasonLength; w++) {
          let games = {};
          schedule[w].forEach(m=>{
            if (!games[m.matchup_id]) games[m.matchup_id]=[];
            games[m.matchup_id].push(m);
          });

          for (const g of Object.values(games)) {
            if (g.length<2) continue;
            let a = simTeams.find(x=>x.roster_id===g[0].roster_id);
            let b = simTeams.find(x=>x.roster_id===g[1].roster_id);
            let probA = a.fpts / ((a.fpts+b.fpts)||1);
            if (Math.random()<probA) a.wins++; else b.wins++;
          }
        }

        simTeams.sort((a,b)=>b.wins-a.wins || b.fpts-a.fpts);
        for (let i=0;i<playoffSpots;i++) {
          let t = results.find(r=>r.roster_id===simTeams[i].roster_id);
          if (t) t.playoffCount++;
        }
      }

      let withOdds = results.map(t=>({
        ...t,
        odds: ((t.playoffCount/sims)*100).toFixed(1)
      }));

      document.getElementById("odds-list").innerHTML =
        withOdds.sort((a,b)=>b.odds-a.odds)
          .map(t=>`<div class="card">
            <div class="team-info">
              <img src="${t.avatar}">
              <div>${t.name} - <small>${t.manager}</small></div>
            </div>
            <span class="badge green">${t.odds}%</span>
          </div>`).join("");
    }

    async function renderMatchups(week) {
      let res = await fetch(`https://api.sleeper.app/v1/league/${LEAGUE_ID}/matchups/${week}`);
      let matchups = await res.json();
      let games={};
      matchups.forEach(m=>{
        if(!games[m.matchup_id]) games[m.matchup_id]=[];
        games[m.matchup_id].push(m);
      });

      let html="";
      for (const g of Object.values(games)) {
        if (g.length<2) continue;
        let a = teams.find(x=>x.roster_id===g[0].roster_id);
        let b = teams.find(x=>x.roster_id===g[1].roster_id);
        html+=`<div class="matchup">
          <div class="team">
            <img src="${a.avatar}" width="30" height="30"><span>${a.name}</span>
          </div>
          <div class="score">${g[0].points||0}</div>
          <div class="score">${g[1].points||0}</div>
          <div class="team">
            <img src="${b.avatar}" width="30" height="30"><span>${b.name}</span>
          </div>
        </div>`;
      }
      document.getElementById("matchup-list").innerHTML=html;
    }

    async function init() {
      await fetchLeagueData();
      await fetchCurrentWeek();
      renderRankings();
      await calculatePlayoffOdds();

      let weekSelect=document.getElementById("weekSelect");
      for (let i=1;i<=currentWeek;i++) {
        let opt=document.createElement("option");
        opt.value=i; opt.text="Week "+i;
        if (i===currentWeek) opt.selected=true;
        weekSelect.appendChild(opt);
      }
      renderMatchups(currentWeek);
      weekSelect.addEventListener("change",e=>renderMatchups(+e.target.value));
    }

    init();
  </script>
</body>
</html>
