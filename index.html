<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantasy Football Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0f1419 0%, #1a2332 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
        }

        .league-name {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00cec9, #6c5ce7);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .season-info {
            font-size: 1.1rem;
            color: #a0a0a0;
        }

        .loading {
            text-align: center;
            padding: 60px 0;
            font-size: 1.2rem;
            color: #a0a0a0;
        }

        .error {
            text-align: center;
            padding: 40px;
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid rgba(231, 76, 60, 0.3);
            border-radius: 12px;
            margin: 20px 0;
            color: #e74c3c;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-body {
            padding: 0;
        }

        .team-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: background-color 0.2s ease;
        }

        .team-row:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .team-row:last-child {
            border-bottom: none;
        }

        .team-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .team-rank {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .team-name {
            font-weight: 600;
            color: #ffffff;
        }

        .team-record {
            color: #a0a0a0;
            font-size: 0.9rem;
            margin-left: auto;
            margin-right: 20px;
        }

        .luck-score {
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 60px;
            text-align: right;
        }

        .luck-positive { color: #00b894; }
        .luck-negative { color: #e17055; }
        .luck-neutral { color: #fdcb6e; }

        .playoff-odds {
            font-weight: 700;
            font-size: 1.1rem;
            min-width: 60px;
            text-align: right;
        }

        .odds-high { color: #00b894; }
        .odds-medium { color: #fdcb6e; }
        .odds-low { color: #e17055; }

        .legend {
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .legend-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: #ffffff;
        }

        .legend-item {
            margin-bottom: 8px;
            color: #a0a0a0;
            font-size: 0.95rem;
        }

        .refresh-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(45deg, #00cec9, #6c5ce7);
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 206, 201, 0.3);
            transition: transform 0.2s ease;
        }

        .refresh-btn:hover {
            transform: scale(1.1);
        }

        .icon {
            width: 20px;
            height: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="league-name" id="leagueName">Loading League...</div>
            <div class="season-info" id="seasonInfo">2024 Season</div>
        </div>

        <div id="loadingState" class="loading">
            Loading league data...
        </div>

        <div id="errorState" class="error" style="display: none;">
            <h3>Error Loading Data</h3>
            <p>Please check your league ID and try again.</p>
        </div>

        <div id="dashboardContent" style="display: none;">
            <div class="stats-grid">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zM9.5 6L14 10.5 9.5 15 8 13.5 10.5 11 8 8.5 9.5 6z"/>
                            </svg>
                            Luck Index
                        </h2>
                    </div>
                    <div class="card-body" id="luckIndexBody">
                        <!-- Luck index data will be populated here -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M5 16L3 14l5.5-5.5L10 10l5.5-5.5L14 3l5 5-1.5 1.5L14 5l-2.5 2.5L14 10l3.5-3.5L19 8l-1.5 1.5L14 6l-5.5 5.5L6 14l5 5 1.5-1.5L8 13z"/>
                            </svg>
                            Playoff Odds
                        </h2>
                    </div>
                    <div class="card-body" id="playoffOddsBody">
                        <!-- Playoff odds data will be populated here -->
                    </div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-title">How it works:</div>
                <div class="legend-item"><strong>Luck Index:</strong> Compares actual wins to expected wins based on points scored vs league average</div>
                <div class="legend-item"><strong>Playoff Odds:</strong> Calculated based on current record, remaining schedule strength, and points scored</div>
                <div class="legend-item"><strong>Colors:</strong> Green (good), Yellow (average), Red (poor)</div>
            </div>
        </div>
    </div>

    <button class="refresh-btn" onclick="loadLeagueData()" title="Refresh Data">
        â†»
    </button>

    <script>
        // CONFIGURE YOUR LEAGUE ID HERE
        const LEAGUE_ID = '1257464138565689344';
        
        let leagueData = {};
        let rosters = [];
        let users = [];
        let matchups = [];

        async function fetchSleeperAPI(endpoint) {
            try {
                const response = await fetch(`https://api.sleeper.app/v1/${endpoint}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error('API fetch error:', error);
                throw error;
            }
        }

        function calculateLuckIndex(roster, allMatchups) {
            let actualWins = 0;
            let totalGames = 0;
            let pointsFor = 0;
            let expectedWins = 0;

            // Get all matchups for this roster
            const rosterMatchups = allMatchups.filter(week => 
                week.some(matchup => matchup.roster_id === roster.roster_id)
            );

            rosterMatchups.forEach(week => {
                const matchup = week.find(m => m.roster_id === roster.roster_id);
                if (matchup && matchup.points !== null) {
                    totalGames++;
                    pointsFor += matchup.points;
                    
                    // Find opponent
                    const opponent = week.find(m => 
                        m.matchup_id === matchup.matchup_id && m.roster_id !== roster.roster_id
                    );
                    
                    if (opponent && matchup.points > opponent.points) {
                        actualWins++;
                    }

                    // Calculate expected wins for this week
                    const weeksOpponents = week.filter(m => m.roster_id !== roster.roster_id);
                    const betterThan = weeksOpponents.filter(m => matchup.points > m.points).length;
                    expectedWins += betterThan / (weeksOpponents.length || 1);
                }
            });

            if (totalGames === 0) return 0;
            
            const luckIndex = actualWins - expectedWins;
            return Math.round(luckIndex * 10) / 10;
        }

        function calculatePlayoffOdds(roster, allMatchups) {
            const wins = roster.settings.wins || 0;
            const losses = roster.settings.losses || 0;
            const totalGames = wins + losses;
            
            if (totalGames === 0) return 0;

            // Simple playoff odds calculation based on current win percentage
            // This is a simplified version - you could make this more sophisticated
            const winPct = wins / totalGames;
            const remainingGames = Math.max(0, 14 - totalGames); // Assuming 14 game season
            
            // Calculate points per game
            let pointsFor = 0;
            let gamesPlayed = 0;
            
            allMatchups.forEach(week => {
                const matchup = week.find(m => m.roster_id === roster.roster_id);
                if (matchup && matchup.points !== null) {
                    pointsFor += matchup.points;
                    gamesPlayed++;
                }
            });
            
            const avgPoints = gamesPlayed > 0 ? pointsFor / gamesPlayed : 0;
            
            // Boost odds based on high scoring
            let oddsBoost = 0;
            if (avgPoints > 120) oddsBoost = 0.15;
            else if (avgPoints > 110) oddsBoost = 0.1;
            else if (avgPoints > 100) oddsBoost = 0.05;
            
            // Simple formula: current win rate + boost - penalty for losses
            const baseOdds = Math.min(0.95, winPct + oddsBoost);
            const finalOdds = Math.max(0.05, baseOdds);
            
            return Math.round(finalOdds * 100);
        }

        function getLuckClass(luckIndex) {
            if (luckIndex > 0.5) return 'luck-positive';
            if (luckIndex < -0.5) return 'luck-negative';
            return 'luck-neutral';
        }

        function getOddsClass(odds) {
            if (odds >= 70) return 'odds-high';
            if (odds >= 30) return 'odds-medium';
            return 'odds-low';
        }

        function renderLuckIndex(teams) {
            const luckIndexBody = document.getElementById('luckIndexBody');
            const sortedTeams = [...teams].sort((a, b) => b.luckIndex - a.luckIndex);
            
            luckIndexBody.innerHTML = sortedTeams.map((team, index) => `
                <div class="team-row">
                    <div class="team-info">
                        <div class="team-rank">${index + 1}</div>
                        <div class="team-name">${team.name}</div>
                    </div>
                    <div class="team-record">${team.wins}-${team.losses}</div>
                    <div class="luck-score ${getLuckClass(team.luckIndex)}">
                        ${team.luckIndex > 0 ? '+' : ''}${team.luckIndex}
                    </div>
                </div>
            `).join('');
        }

        function renderPlayoffOdds(teams) {
            const playoffOddsBody = document.getElementById('playoffOddsBody');
            const sortedTeams = [...teams].sort((a, b) => b.playoffOdds - a.playoffOdds);
            
            playoffOddsBody.innerHTML = sortedTeams.map((team, index) => `
                <div class="team-row">
                    <div class="team-info">
                        <div class="team-rank">${index + 1}</div>
                        <div class="team-name">${team.name}</div>
                    </div>
                    <div class="team-record">${team.wins}-${team.losses}</div>
                    <div class="playoff-odds ${getOddsClass(team.playoffOdds)}">
                        ${team.playoffOdds}%
                    </div>
                </div>
            `).join('');
        }

        async function loadLeagueData() {
            try {
                document.getElementById('loadingState').style.display = 'block';
                document.getElementById('errorState').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'none';

                // Fetch league data
                leagueData = await fetchSleeperAPI(`league/${LEAGUE_ID}`);
                document.getElementById('leagueName').textContent = leagueData.name;
                document.getElementById('seasonInfo').textContent = `${leagueData.season} Season â€¢ Week ${leagueData.settings.leg || 1}`;

                // Fetch rosters and users
                [rosters, users] = await Promise.all([
                    fetchSleeperAPI(`league/${LEAGUE_ID}/rosters`),
                    fetchSleeperAPI(`league/${LEAGUE_ID}/users`)
                ]);

                // Fetch all matchups for the season
                const totalWeeks = leagueData.settings.playoff_week_start - 1;
                const matchupPromises = [];
                for (let week = 1; week <= totalWeeks; week++) {
                    matchupPromises.push(fetchSleeperAPI(`league/${LEAGUE_ID}/matchups/${week}`));
                }
                matchups = await Promise.all(matchupPromises);

                // Process data
                const teams = rosters.map(roster => {
                    const user = users.find(u => u.user_id === roster.owner_id);
                    const luckIndex = calculateLuckIndex(roster, matchups);
                    const playoffOdds = calculatePlayoffOdds(roster, matchups);
                    
                    return {
                        name: user ? (user.display_name || user.username || 'Unknown') : 'Unknown',
                        wins: roster.settings.wins || 0,
                        losses: roster.settings.losses || 0,
                        luckIndex: luckIndex,
                        playoffOdds: playoffOdds
                    };
                });

                // Render the data
                renderLuckIndex(teams);
                renderPlayoffOdds(teams);

                // Show dashboard
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('dashboardContent').style.display = 'block';

            } catch (error) {
                console.error('Error loading league data:', error);
                document.getElementById('loadingState').style.display = 'none';
                document.getElementById('errorState').style.display = 'block';
            }
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', loadLeagueData);
    </script>
</body>
</html>